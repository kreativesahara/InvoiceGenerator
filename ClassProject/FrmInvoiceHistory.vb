Imports System.Data.OleDb
Imports System.Threading.Tasks

Public Class FrmInvoiceHistory    Inherits Form    Private dgvHistory As New DataGridView() With {.Dock = DockStyle.Fill, .ReadOnly = True, .SelectionMode = DataGridViewSelectionMode.FullRowSelect}    Private btnSelect As New Button() With {.Text = "Select", .Dock = DockStyle.Bottom, .Height = 30}    Private parentForm As FrmProformaInvoice    Public Sub New(parent As FrmProformaInvoice)        Me.parentForm = parent        Me.Text = "Invoice History"        Me.ClientSize = New Size(600, 400)        Me.Controls.Add(dgvHistory)        Me.Controls.Add(btnSelect)        AddHandler btnSelect.Click, AddressOf BtnSelect_Click        LoadHistory()    End Sub    Private Sub LoadHistory()        Task.Run(Sub()                     Try                         Dim dbPath = IO.Path.Combine(LicenseManager.AppFolder, "invoices.accdb")                         Dim connStr = $"Provider=Microsoft.ACE.OLEDB.12.0;Data Source={dbPath};Persist Security Info=False;"                         Using conn As New OleDbConnection(connStr)                             conn.Open()                             Dim cmd As New OleDbCommand("SELECT ID, InvoiceDate, Client, Total FROM Invoices ORDER BY InvoiceDate DESC", conn)                             Dim dt As New DataTable()                             Dim adapter As New OleDbDataAdapter(cmd)                             adapter.Fill(dt)                             Me.Invoke(Sub()                                           dgvHistory.DataSource = dt                                       End Sub)                         End Using                     Catch ex As Exception                         Me.Invoke(Sub() MessageBox.Show("Failed to load history: " & ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error))                     End Try                 End Sub)    End Sub    Private Sub BtnSelect_Click(sender As Object, e As EventArgs)        If dgvHistory.SelectedRows.Count = 0 Then            MessageBox.Show("Select a row first.", "Info", MessageBoxButtons.OK, MessageBoxIcon.Information)            Return        End If        Dim id = Convert.ToInt32(dgvHistory.SelectedRows(0).Cells("ID").Value)        parentForm.LoadInvoiceForEdit(id)        Me.Close()    End SubEnd Class